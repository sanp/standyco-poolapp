{% extends "base.html" %}
{% load staticfiles %}

{% block page_title %}
Post a tournament
{% endblock page_title %}

{% block content-body %}

<div class="row">

  <div class="large-6 medium-6 large-centered medium-centered columns">

    <br />

    <!-- Body section open -->
  
    <!-- Error message -->
    <div class="row">
      {% if form.errors %}
      <div class="form-error-msg large-12 medium-12 columns">
        <p>
        The operation could not be performed because one or more error(s)
        occurred. Please resubmit the form after making the following
        changes:
        </p>
        <ul>
        {% for field in form %}
          {% if field.errors %}
            <li>{{ field.name|title }}: {{ field.errors|striptags }}</li>
          {% endif %}
        {% endfor %}
        </ul>
      </div>
      {% endif %}
    </div>

    <div class="row">
  
      <div class="large-12 medium-12 columns">
  
        <form method="post">
          {% csrf_token %}

          <!-- Start of Title Section -->
          <div class="form-section">
    
            <div class="section-title row">
              <div class="large-10 medium-10 small-10 columns">
                <p>Title</p>
              </div>
              <div class="large-2 medium-2 small-2 columns">
                <div class="form-section-required">Required</div>
              </div>
            </div>
    
            <div class="form-group row">
              <!-- Select box -->
              <div class="required large-12 medium-12 columns">
                <label class="required_label">Tournament title
                  {{ form.title }}
                </label>
              </div>
            </div>
    
          </div>
          <!-- End of Additional Info section -->
    
          
    
          <!-- Start of Place section -->
          <div class="form-section">
    
            <div class="section-title row">
              <div class="large-12 columns">
                <p>Place</p>
              </div>
            </div>
    
            <div class="form-group">
    
              <div class="row">
    
                <div class="required large-6 medium-6 columns">
                  <label class="required_label">State
                    {{ form.state }}
                  </label>
                </div>

                <div class="required large-6 medium-6 columns">
                  <label class="required_label">City
                    {{ form.city }}
                  </label>
                </div>
    
              </div>
    
              <div class="row">
                <div class="required large-12 columns">
                  <label class="required_label">Establishment
                    {{ form.pool_hall }}
                  </label>
                </div>
              </div>
            </div>
    
          </div>
          <!-- End of place section -->
    
          
    
          <!-- Start of Structure section -->
          <div class="form-section">
    
            <div class="section-title row">
              <div class="large-12 columns">
                <p>Structure</p>
              </div>
            </div>
    
            <div class="form-group">
    
              <div class="row">

                <div class="required large-6 medium-6 columns">
                  <label class="required_label">Game
                    {{ form.game }}
                  </label>
                </div>

                <div id="other_game" class="optional_txt_box large-6 medium-6 columns">
                  <label>Other Game Type
                    {{ form.game_other }}
                  </label>
                </div>

              </div>
    
              <div class="row">

                <div class="required large-6 medium-6 columns">
                  <label class="required_label">Field size
                    {{ form.field_size }}
                  </label>
                </div>

                <div id="other_field_size" class="optional_txt_box large-6 medium-6 columns">
                  <label>Other Field size
                    {{ form.field_size_other }}
                  </label>
                </div>

              </div>
    
              <div class="row">

                <div class="required large-6 medium-6 columns">
                  <label class="required_label">Format
                    {{ form.tourney_format }}
                  </label>
                </div>

                <div id="other_tourney_format" class="optional_txt_box large-6 medium-6 columns">
                  <label>Other Format
                    {{ form.tourney_format_other }}
                  </label>
                </div>

              </div>

              <div id="race_to_row" class="row">

                <div class="required large-6 medium-6 columns">
                  <label class="required_label">Race To
                    {{ form.race_to_single }}
                  </label>
                </div>

              </div>

              <div id="race_to_double_row" class="row">

                <div class="required large-6 medium-6 columns">
                  <label class="required_label">Race To on A-Side
                    {{ form.race_to_a }}
                  </label>
                </div>

                <div class="required large-6 medium-6 columns">
                  <label class="required_label">Race To on B-Side
                    {{ form.race_to_b }}
                  </label>
                </div>

              </div>

              <div class="row">
                <div class="required large-6 medium-6 columns">
                  <!-- Note: label must be outside. Cannot put multiple -->
                  <!-- elements inside of one label, otherwise it will break  -->
                  <!-- in Firefox. Instead, use label with for=the name of -->
                  <!-- the radio group -->
                  <label for="formtools_has_calcutta" class="required_label">
                    Calcutta
                  </label>
                  {{ form.has_calcutta }}
                </div>
              </div>
    
            </div>
    
          </div>
          <!-- End of structure section -->
    
          
    
          <!-- Start of Money section -->
          <div class="form-section">
    
            <div class="section-title row">
              <div class="large-12 columns">
                <p>Money</p>
              </div>
            </div>
    
            <div class="form-group">
    
              <div class="row">
                <!-- Select box -->
                <div class="required large-12 medium-12 columns">
                  <label class="required_label">Entry fee
                    {{ form.fee }}
                  </label>
                </div>
              </div>

              <div class="row">

                <div class="required large-6 medium-6 columns">
                  <!-- Note: label must be outside. Cannot put multiple -->
                  <!-- elements inside of one label, otherwise it will break  -->
                  <!-- in Firefox. Instead, use label with for=the name of -->
                  <!-- the radio group -->
                  <label for="formtools_green_fees_included" class="required_label">
                    Green Fees Included
                  </label>
                  {{ form.green_fees_included }}
                </div>

                <div id="optional_green_fees" class="optional_txt_box large-6 medium-6 columns">
                  <label class=optional_txt_box">Green Fees
                    {{ form.green_fees }}
                  </label>
                </div>

              </div>
    
              <div class="row">
                <div class="required large-12 medium-12 columns">
                  <label class="required_label">Added money
                    {{ form.added_money }}
                  </label>
                </div>
              </div>


              <div class="row">
                <div class="required large-12 medium-12 columns">
                  <!-- Note: label must be outside. Cannot put multiple -->
                  <!-- elements inside of one label, otherwise it will break  -->
                  <!-- in Firefox. Instead, use label with for=the name of -->
                  <!-- the radio group -->
                  <label for="formtools_added_money_based_on_full_field" class="required_label">
                    Based on a full field
                  </label>
                  {{ form.added_money_based_on_full_field }}
                </div>
              </div>

            </div>

          </div>
          <!-- End of Money section -->
    
          
    
          <!-- Start of Time section -->
          <div class="form-section">
    
            <div class="section-title row">
              <div class="large-12 columns">
                <p>Time</p>
              </div>
            </div>
    
            <div class="form-group">
    
              <div class="row">
                <div class="required large-12 medium-12 columns">
                  <label class="required_label">Start Date
                    {{ form.start_date }}
                  </label>
                </div>
              </div>

              <div class="row">

                <div class="required large-6 medium-6 columns">
                  <!-- Note: label must be outside. Cannot put multiple -->
                  <!-- elements inside of one label, otherwise it will break  -->
                  <!-- in Firefox. Instead, use label with for=the name of -->
                  <!-- the radio group -->
                  <label for="formtools_multiple_days" class="required_label">
                    Multiple days
                  </label>
                  {{ form.multiple_days }}
                </div>

                <div id="optional_end_date" class="optional_txt_box large-6 medium-6 columns">
                  <label class=optional_txt_box">End Date
                    {{ form.end_date }}
                  </label>
                </div>

              </div>


    
              <div class="row">
                <!-- Select box -->
                <div class="required large-12 medium-12 columns">
                  <label class="required_label">Start time
                    {{ form.start_time }}
                  </label>
                </div>
              </div>
    
            </div>
    
          </div>
          <!-- End of Time section -->
    
          
    
          <!-- Start of Contact section -->
          <div class="form-section">
    
            <div class="section-title row">
              <div class="large-12 columns">
                <p>Contact</p>
              </div>
            </div>
    
            <div class="form-group">
    
              <div class="row">
                <!-- Select box -->
                <div class="required large-12 medium-12 columns">
                  <label class="required_label">Contact name
                    {{ form.contact_name }}
                  </label>
                </div>
              </div>
    
              <div class="row">
                <!-- Select box -->
                <div class="required large-12 medium-12 columns">
                  <label class="required_label">Contact phone
                    {{ form.contact_phone }}
                  </label>
                </div>
              </div>
    
              <div class="row">
                <!-- Select box -->
                <div class="required large-12 medium-12 columns">
                  <label class="required_label">Contact email
                    {{ form.contact_email }}
                  </label>
                </div>
              </div>
    
            </div>
    
          </div>
          <!-- End of Contact section -->
    
          
    
          <!-- Start of Additional Info -->
          <div class="form-section">
    
            <div class="section-title row">
              <div class="large-12 columns">
                <p>Almost done!</p>
              </div>
            </div>
    
            <div class="form-group">
    
              <div class="row">
                <!-- Select box -->
                <div class="large-12 medium-12 columns">
                  <label>Additional Info
                    {{ form.adtnl_info }}
                  </label>
                </div>
              </div>
    
            </div>
    
          </div>
          <!-- End of Additional Info section -->
  
  
          
          <button type="submit" class="button radius expand">Preview your post</button>
  
          <div class="form-section-notice" style="">
            Please fill out all required (<span class="star">*</span>) fields.
          </div>
  
        </form>
  
      </div>
  
    </div>
  <!-- Body section close -->

  </div>
</div>

{% endblock content-body %}

{% block bottomjs %}

<!-- Foundation Datepicker (based on Bootstrap datepicker) begin -->
<!-- See: http://foundation-datepicker.peterbeno.com/example.html -->
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="{% static 'poolapp/js/foundation_datepicker/foundation-datepicker.css' %}"/ >
<script src="{% static 'poolapp/js/foundation_datepicker/foundation-datepicker.js' %}"></script>

<!-- Time and date picker js -->
<script type='text/javascript'>
    jQuery(function(){

      function renderDates(endDateSelected) {

        if (endDateSelected) {
          // implementation of disabled form fields
          var nowTemp = new Date();
          var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);
          var start_date = $('.start_fdatepicker').fdatepicker({
            onRender: function (date) {
              return date.valueOf() < now.valueOf() ? 'disabled' : '';
            }
          }).on('changeDate', function (ev) {
            if (ev.date.valueOf() > end_date.date.valueOf()) {
              var newDate = new Date(ev.date)
              newDate.setDate(newDate.getDate() + 1);
              end_date.update(newDate);
            }
            start_date.hide();
            $('.end_fdatepicker')[0].focus();
          }).data('datepicker');
          var end_date = $('.end_fdatepicker').fdatepicker({
            onRender: function (date) {
              return date.valueOf() <= start_date.date.valueOf() ? 'disabled' : '';
            }
          }).on('changeDate', function (ev) {
            end_date.hide();
          }).data('datepicker');
        } else {
          var nowTemp = new Date();
          var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);
          var start_date = $('.start_fdatepicker').fdatepicker({
            onRender: function (date) {
              return date.valueOf() < now.valueOf() ? 'disabled' : '';
            }
          });
        }

      }

      function resetForm(element) {
        $(element).val(function() {
          return this.defaultValue;
        });
      }

      function setInitialEndDate() {
        var currentStartDateString = $('.start_fdatepicker').val();
        if (currentStartDateString) {
          var initEndDate = new Date(currentStartDateString);
          initEndDate.setDate(initEndDate.getDate() + 1);
          var day = initEndDate.getDate() + '';
          var month = initEndDate.getMonth() + 1; // months are 0-based
          var year = initEndDate.getFullYear();
          //pull the last two digits of the year
          year = year.toString().substr(2,2);
          month = month + '';
          // Just want the last 2 digits for the year
          var endDateString = month + '/' + day + '/' + year;
          $('.end_fdatepicker').val(function() {
            return endDateString;
          });
        }
      }


      // End Date hide/show options
      if ($("input[id=formtools_multiple_days_0]:checked").val()) {
          $("#optional_end_date").show();
          setInitialEndDate();
          renderDates(endDateSelected=true);
      } else {
          $("#optional_end_date").hide();
          renderDates(endDateSelected=false);
          resetForm('.end_fdatepicker');
      }
      $('input[name=multiple_days]').click(function () {
          if (this.id == "formtools_multiple_days_0") {
              $("#optional_end_date").show();
              setInitialEndDate();
              renderDates(endDateSelected=true);
          } else {
              $("#optional_end_date").hide();
              renderDates(endDateSelected=false);
              resetForm('.end_fdatepicker');
          }
      });

    // Logic for showing and hiding elements based on selections of other
    // elements

    // Other hide/show options
    var elements = {
      // key = formtools div id for dropdown element
      // value[0] = other option number, from models.py
      // value[1] = div id for 'other' text box element
      // value[2] = div id for formtools 'other' text box element
      '#formtools_game': [6, '#other_game', '#formtools_game_other'],
      '#formtools_tourney_format': [2, '#other_tourney_format', 
          '#formtools_tourney_format_other'],
      '#formtools_field_size': [5, '#other_field_size',
          '#formtools_field_size_other']
    };

    $.each(elements, function( key, value ) {

      // Handle show/hide logic for when page is reloaded, not just when the
      // menu element changes - for example, if the user hits 'preview', but
      // there are form errors, the 'Other Game' text box should still appear
      if($(key).val() == value[0]){
          $(value[1]).show();
          resetForm(value[2]);
      }
      else{
          $(value[1]).hide();
          resetForm(value[2]);
      }
      $(key).change(function() {
          if($(this).val() == value[0]){
              $(value[1]).show();
              resetForm(value[2]);
          }
          else{
              $(value[1]).hide();
              resetForm(value[2]);
          }
      });

    });

    // Race to hide/show options
    // See models.py -- 0 is single elimination. 1 is double. 2 is other.
    // Make sure to reset the form fields so that they aren't accidentally
    // popualted if the user changes his/her mind when selecting other
    // categories
    if($('#formtools_tourney_format').val() == 1){
        $('#race_to_double_row').show();
        $('#race_to_row').hide();
        resetForm('#formtools_race_to_single');
        resetForm('#formtools_race_to_a');
        resetForm('#formtools_race_to_b');
    }
    else{
        $('#race_to_double_row').hide();
        $('#race_to_row').show();
        resetForm('#formtools_race_to_single');
        resetForm('#formtools_race_to_a');
        resetForm('#formtools_race_to_b');
    }
    $('#formtools_tourney_format').change(function() {
        if($(this).val() == 1){
            $('#race_to_double_row').show();
            $('#race_to_row').hide();
            resetForm('#formtools_race_to_single');
            resetForm('#formtools_race_to_a');
            resetForm('#formtools_race_to_b');
        }
        else{
            $('#race_to_double_row').hide();
            $('#race_to_row').show();
            resetForm('#formtools_race_to_single');
            resetForm('#formtools_race_to_a');
            resetForm('#formtools_race_to_b');
        }
    });


    // Green Fees hide/show options
    // Make sure to reset the form fields so that they aren't accidentally
    // popualted if the user changes his/her mind when selecting other
    // categories
    if ($("input[id=formtools_green_fees_included_0]:checked").val()) {
        $("#optional_green_fees").hide();
        resetForm('#formtools_green_fees');
    } else {
        $("#optional_green_fees").show();
        resetForm('#formtools_green_fees');
    }
    $('input[name=green_fees_included]').click(function () {
        if (this.id == "formtools_green_fees_included_0") {
            $("#optional_green_fees").hide();
            resetForm('#formtools_green_fees');
        } else {
            $("#optional_green_fees").show();
            resetForm('#formtools_green_fees');
        }
    });

  });
</script>
<!-- Foundation Datepicker (based on Bootstrap datepicker) end -->

<!-- Datepicker JQuery -->
<!-- JQuery timepicker library -->
<!-- cf: http://xdsoft.net/jqplugins/datetimepicker/  -->
<!-- this should go after your </body> -->

<!-- <link rel="stylesheet" type="text/css" href="{% static 'poolapp/js/datetimepicker-master/jquery.datetimepicker.css' %}"/ > -->
<!-- <script type='text/javascript' src='//code.jquery.com/jquery-1.10.2.js'></script> -->
<!-- <script src="{% static 'poolapp/js/datetimepicker-master/jquery.datetimepicker.js' %}"></script> -->

<!-- Time and date picker js -->

<!-- <script type='text/javascript'> -->
<!--     jQuery(function(){ -->
<!--      -->
<!--         jQuery('.datepicker').datetimepicker({ -->
<!--           // Use this to initialize plugin only when user interacts. Maybe a -->
<!--           // good idea, but it seems to cause a split-second lag on first load, -->
<!--           // which i don't like -->
<!--           //lazyInit: true, -->
<!--           format:'m/d/Y', -->
<!--           timepicker:false, -->
<!--           minDate: '0', -->
<!--           closeOnDateSelect:true, -->
<!--         }); -->
<!--      -->
<!--         jQuery('.timepicker').datetimepicker({ -->
<!--           //lazyInit: true, -->
<!--           datepicker:false, -->
<!--           format:'H:i', -->
<!--           formatTime:'h:i a' -->
<!--         }); -->
<!--      -->
<!--     }); -->
<!-- </script> -->

<!-- Phone number formatting -->
<!-- Cf: http://digitalbush.com/projects/masked-input-plugin/ -->

<!-- <script type='text/javascript' src='//code.jquery.com/jquery-1.5.2.js'></script> -->
<!-- <script src="{% static 'poolapp/js/jquery.maskedinput-1.2.2.js' %}"></script> -->
<!-- <script type='text/javascript'> -->
<!--     // Use noconflict mode to allow use of multiple versions of jQuery with no -->
<!--     // conflict -- Need different versions for the datepicker lib vs the phone mask -->
<!--     // lib -- NOTE: Make sure that the older version of jQuery is loaded before -->
<!--     // the newer version. -->
<!--     var jQuery_1_5_2 = $.noConflict(true); -->
<!--     jQuery(function($){ -->
<!--         jQuery_1_5_2('.phone').mask('(999) 999-9999');  -->
<!--     }); -->
<!-- </script> -->


{% endblock bottomjs %}
